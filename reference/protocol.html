<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Communication Protocol &#8212; Python-Skill Bridge  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Remote Objects" href="remote-object.html" />
    <link rel="prev" title="Reference" href="index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="communication-protocol">
<h1>Communication Protocol<a class="headerlink" href="#communication-protocol" title="Link to this heading">¶</a></h1>
<figure class="align-default" id="id1">
<img alt="../_images/components.svg" src="../_images/components.svg" /><figcaption>
<p><span class="caption-text">The different components of the Skill Bridge</span><a class="headerlink" href="#id1" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The block diagram shows two important communication interfaces.
namely, the TCP/Unix socket interface between the client library
and the python server and the IPC interface between the skill script and the python server.</p>
<section id="the-ipc-protocol">
<h2>The IPC protocol<a class="headerlink" href="#the-ipc-protocol" title="Link to this heading">¶</a></h2>
<p>The skill script communicated via <code class="docutils literal notranslate"><span class="pre">stdin</span></code> and <code class="docutils literal notranslate"><span class="pre">stdout</span></code> with the python server. All
messages are initiated by the python server (called <em>question</em>) which is followed by
exactly one <em>answer</em> from the skill. All <em>questions</em> and <em>answers</em> are terminated by
a newline character <code class="docutils literal notranslate"><span class="pre">\n</span></code>.</p>
<section id="the-question">
<h3>The Question<a class="headerlink" href="#the-question" title="Link to this heading">¶</a></h3>
<p>A <em>question</em> consists a single line containing executable skill code. See the following examples:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;1 + 2\n&quot;</span>

<span class="s">&quot;geGetEditCellView()\n&quot;</span>

<span class="s">&quot;__py_cell = geGetEditCellView()\n&quot;</span>
</pre></div>
</div>
</section>
<section id="the-answer">
<h3>The Answer<a class="headerlink" href="#the-answer" title="Link to this heading">¶</a></h3>
<p>An <em>answer</em> consists of the execution status, either <code class="docutils literal notranslate"><span class="pre">&quot;failure&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;success&quot;</span></code>,
and the result itself. The result is exactly the string representation given by skill.</p>
<p>Examples:</p>
<div class="highlight-lisp notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;success 1\n&quot;</span>

<span class="s">&quot;success (1 2 3)\n&quot;</span>

<span class="s">&quot;success db:0x1234\n&quot;</span>

<span class="s">&quot;failure error ...\n&quot;</span>
</pre></div>
</div>
<figure class="align-default" id="id2">
<img alt="../_images/diagrams-question-answer.svg" src="../_images/diagrams-question-answer.svg" /><figcaption>
<p><span class="caption-text">Sequence diagram for the question and answer protocol</span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="behaviour">
<h3>Behaviour<a class="headerlink" href="#behaviour" title="Link to this heading">¶</a></h3>
<p>The skill script waits for <em>questions</em>. When it receives one it executes the code.
In case of an error it sends an <em>answer</em> beginning with <code class="docutils literal notranslate"><span class="pre">&quot;failure&quot;</span></code> followed by the
error message. Otherwise it sends an <em>answer</em> beginning with <code class="docutils literal notranslate"><span class="pre">&quot;success&quot;</span></code> followed by
the string representation of the result.</p>
<p>The python server waits one minute after it sent a <em>question</em>. It it does not receive
an <em>answer</em> in that time it automatically assumes the following <em>answer</em>:
<code class="docutils literal notranslate"><span class="pre">&quot;failure</span> <span class="pre">&lt;timeout&gt;&quot;</span></code>.</p>
</section>
<section id="test-mode">
<h3>Test Mode<a class="headerlink" href="#test-mode" title="Link to this heading">¶</a></h3>
<p>There is one exception to the protocol above. If the server is started with the <code class="docutils literal notranslate"><span class="pre">-notify</span></code>
option it will send a single message containing “runningn” via stdout. This message
must not be executed as skill code. Its sole purpose is to notify the parent process
that the server is running.</p>
</section>
</section>
<section id="the-socket-protocol">
<h2>The Socket Protocol<a class="headerlink" href="#the-socket-protocol" title="Link to this heading">¶</a></h2>
<p>This protocol is similar to the IPC protocol. The difference is the way single messages are
grouped together. As TCP has no concept of messages, the length of the message is sent first,
followed by the message itself. As the length of the length can also vary, it is fixed to
exactly 10 digits. Smaller lengths must be padded with either zeros or spaces.</p>
<p>See the following examples:</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;1 + 2&quot;</span><span class="p">)</span>
<span class="go">b&#39;00000000051 + 2&#39;</span>
</pre></div>
</div>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;__py_cell = geGetEditCellView()&quot;</span><span class="p">)</span>
<span class="go">b&#39;0000000031__py_cell = geGetEditCellView()&#39;</span>
</pre></div>
</div>
<figure class="align-default" id="id3">
<img alt="../_images/diagrams-socket.svg" src="../_images/diagrams-socket.svg" /><figcaption>
<p><span class="caption-text">Sequence diagram for the socket protocol</span><a class="headerlink" href="#id3" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
<section id="a-full-roundtrip">
<h2>A Full Roundtrip<a class="headerlink" href="#a-full-roundtrip" title="Link to this heading">¶</a></h2>
<figure class="align-default" id="id4">
<img alt="../_images/diagrams-flow.svg" src="../_images/diagrams-flow.svg" /><figcaption>
<p><span class="caption-text">A full roundtrip of a single python expression</span><a class="headerlink" href="#id4" title="Link to this image">¶</a></p>
</figcaption>
</figure>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">Python-Skill Bridge</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../usage/index.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Reference</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Communication Protocol</a></li>
<li class="toctree-l2"><a class="reference internal" href="remote-object.html">Remote Objects</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Reference</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Reference</a></li>
      <li>Next: <a href="remote-object.html" title="next chapter">Remote Objects</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2019, Niels Buwen.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/reference/protocol.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>